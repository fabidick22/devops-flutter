name: "Build and Release APK"

on:
  push:
    branches:
      - "ci-cd-pipeline"

jobs:
  pre-release:
    name: "Pre Release"
    runs-on: "ubuntu-latest"

    steps:
      - uses: actions/checkout@v1

      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'

      - uses: subosito/flutter-action@v1
        with:
          flutter-version: '1.17.1'
      - run: flutter pub get
      - run: flutter test
      - run: flutter build apk --debug --split-per-abi

      - name: Show apk
        run: |
          pwd
          ls build/app/outputs/apk/debug/

      - name: "Build & test"
        run: |
          echo "done!"

#      - uses: "marvinpinto/action-automatic-releases@latest"
#        with:
#          repo_token: "${{ secrets.TOKEN }}"
#          automatic_release_tag: "latest"
#          prerelease: true
#          title: "Development Build"
#          files: |
#            build/app/outputs/apk/debug/*.apk

      - name: Tag
          uses: K-Phoen/semver-release-action@master
          with:
            release_branch: master
          env:
            GITHUB_TOKEN: ${{ secrets.TOKEN }}