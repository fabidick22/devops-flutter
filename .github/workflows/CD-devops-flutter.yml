name: "Build and Release APK"

on:
  push:
    branches:
      - "master"

jobs:
  pre-release:
    name: "Pre Release"
    runs-on: "ubuntu-latest"
    env:
      RELEASE_PATH: "releases/"
      MODE: "release"
    steps:
      - uses: actions/checkout@v1

      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'

      - uses: subosito/flutter-action@v1
        with:
          flutter-version: '1.17.1'
      - run: flutter pub get
      - run: flutter build apk

      - name: Show apk
        run: |
          pwd
          ls build/app/outputs/apk/${{ env.MODE }}/

      - name: "Build & test"
        run: |
          echo "done!"

      - name: Bump version and push tag
        uses: anothrNick/github-tag-action@1.17.2
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
          WITH_V: true

#      - uses: "marvinpinto/action-automatic-releases@latest"
#        with:
#          repo_token: "${{ secrets.TOKEN }}"
#          automatic_release_tag: "latest"
#          prerelease: true
#          title: "Development Build"
#          files: |
#            build/app/outputs/apk/debug/*.apk
